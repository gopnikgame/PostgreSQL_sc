# PostgreSQL_sc
Быстрый старт:
```bash
wget -qO restore_db.sh https://raw.githubusercontent.com/gopnikgame/PostgreSQL_sc/main/restore_db.sh && chmod +x restore_db.sh && sudo ./restore_db.sh
```
## Обзор
Скрипт `restore_db.sh` предназначен для восстановления базы данных PostgreSQL из резервной копии на новом сервере. Он автоматизирует процесс установки PostgreSQL, создания пользователей и баз данных, а также восстановления данных из файла резервной копии.

## Предварительные требования
- Linux-система с установленным `bash`.
- Права `sudo` для пользователя, запускающего скрипт.
- Файл резервной копии базы данных, размещённый в директории `~/backup`.

## Использование
1. Поместите файл резервной копии в директорию `~/backup`.
2. Запустите скрипт:
   
bash restore_db.sh

3. Следуйте инструкциям и введите необходимые данные:
   - Имя пользователя базы данных
   - Пароль пользователя базы данных
   - Имя базы данных
   - Имя файла резервной копии
   - Версия PostgreSQL
   - Порт PostgreSQL

4. Подтвердите действия, когда будет предложено.

## Параметры
- **DB_USER**: Имя пользователя PostgreSQL.
- **DB_PASSWORD**: Пароль для пользователя базы данных.
- **DB_NAME**: Имя базы данных для восстановления.
- **BACKUP_FILENAME**: Имя файла резервной копии (должен находиться в директории `~/backup`).
- **PG_VERSION**: Версия PostgreSQL для установки (если ещё не установлена).
- **PG_PORT**: Порт, на котором будет работать PostgreSQL.

## Особенности
- Автоматическая установка PostgreSQL, если он ещё не установлен.
- Настройка методов аутентификации в файле `pg_hba.conf`.
- Поддержка текстовых SQL-дампов и бинарных резервных копий.
- Подробные логи ошибок в файле `/tmp/pg_restore_error.log` в случае неудачи.
- Генерация URL для подключения к восстановленной базе данных.

## Устранение неполадок
- Убедитесь, что файл резервной копии находится в директории `~/backup` перед запуском скрипта.
- Если скрипт завершился с ошибкой, проверьте лог ошибок в файле `/tmp/pg_restore_error.log`.
- Убедитесь, что служба PostgreSQL запущена:
  
sudo systemctl status postgresql

- Проверьте, что установлена правильная версия PostgreSQL.

## Пример
1. Поместите файл `backup.sql` в директорию `~/backup`.
2. Запустите скрипт:
   
bash restore_db.sh

3. Введите следующие данные при запросе:
   - Имя пользователя базы данных: `myuser`
   - Пароль пользователя базы данных: `mypassword`
   - Имя базы данных: `mydatabase`
   - Имя файла резервной копии: `backup.sql`
   - Версия PostgreSQL: `16`
   - Порт PostgreSQL: `5432`

4. Подтвердите действия, и база данных будет восстановлена.

## Примечания
- Скрипт изменяет файл `pg_hba.conf`, чтобы использовать метод аутентификации `md5`.
- Убедитесь, что на диске достаточно места для процесса восстановления базы данных.